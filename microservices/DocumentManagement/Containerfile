# -------- Stage 1: Build --------
FROM eclipse-temurin:25-jdk-alpine AS build
WORKDIR /app

# 1. Copy Maven wrapper and POM
COPY service/mvnw .
COPY service/.mvn .mvn
COPY service/pom.xml .

# 2. Make Maven wrapper executable
RUN chmod +x ./mvnw

# 3. Copy the JAR into the container's temp folder
# (Ensure this path matches your actual file structure on your PC)
COPY service/libs/cy-framework-1.0.0.jar /tmp/cy-framework.jar

# 4. CRITICAL STEP: Install the JAR manually inside Docker
# The GroupID (-DgroupId) MUST match what is in your pom.xml
RUN ./mvnw install:install-file \
    -Dfile=/tmp/cy-framework.jar \
    -DgroupId=com.cyframework \
    -DartifactId=cy-framework \
    -Dversion=1.0.0 \
    -Dpackaging=jar

# 5. NOW run go-offline (Maven will now find the jar locally)
RUN ./mvnw dependency:go-offline

# 6. Continue build...
COPY service/src ./src
RUN ./mvnw package -DskipTests